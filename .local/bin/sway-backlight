#!/bin/sh

error() {
	echo >&2 "$*"
	exit 1
}

[ $# -gt 0 ] || error "Usage: $0 <action> <amount> (e.g. $0 inc 10)"

if modinfo ddcci 2> /dev/null; then
	lsmod | grep -q ddcci || exec doas modprobe ddcci
fi

increase() {
	if [ $# -gt 1 ]; then
		brightnessctl -d "$1" set +"$2"
	else
		brightnessctl set +"$1"
	fi
}

decrease() {
	if [ $# -gt 1 ]; then
		brightnessctl -d "$1" set "$2"-
	else
		brightnessctl set "$1"-
	fi
}

get() {
	if [ $# -gt 0 ]; then
		brightnessctl -m -d "$1" | awk -F, '{print substr($4, 0, length($4)-1)}'
	else
		brightnessctl -m | awk -F, '{print substr($4, 0, length($4)-1)}'
	fi
}

if [ "$1" = "-d" ]; then
	case "$3" in
		inc) increase "$2" "$4" ;;
		dec) decrease "$2" "$4" ;;
		get) get "$2" ;;
	esac
else
	case "$1" in
		inc) increase "$2" ;;
		dec) decrease "$2" ;;
		get) get ;;
	esac
fi
